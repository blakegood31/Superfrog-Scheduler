<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8" />
        <meta 
            name="superfrog edit availability page"
            content="this page allows superfrog students to update their availability"/>
        <meta name="keywords"/>
        <title>Update Availability</title>
        <link rel="stylesheet" href="CSS/availability_style.css">
    </head>
<body>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Availability</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>


<body>
    <div id="app">
        <div>
            <table v-cloak>
                <tr>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                <tr tabindex="0" v-for="(item, index) in requests">
                    <td>{{item.eventTitle}}</td>
                    <td>{{item.date}}</td>
                    <td>{{item.startTime}}</td>
                    <td>{{item.endTime}}</td>
                    <td>{{item.address}}</td>
                    <td>{{item.status}}</td>
                    <td>
                        <button @click="viewFullRequest(item.id)">View Full Request</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                requests: []
            },
            created(){
                fetch('http://127.0.0.1:8080/requests')
                    .then(response => {
                        if (!response.ok) {
                        throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log(data);
                        this.requests = data.data;
                        this.requests.forEach(item => {
                            // Create Date objects from startTime and endTime strings
                            item.startTime = new Date(item.startTime);
                            item.endTime = new Date(item.endTime);
                            // Format date and times to be used in table 
                            const startDate = `${('0' + (item.startTime.getMonth() + 1)).slice(-2)}-${('0' + item.startTime.getDate()).slice(-2)}-${item.startTime.getFullYear() % 100}`;
                            const startTime = `${('0' + item.startTime.getHours()).slice(-2)}:${('0' + item.startTime.getMinutes()).slice(-2)}`;
                            const endTime = `${('0' + item.endTime.getHours()).slice(-2)}:${('0' + item.endTime.getMinutes()).slice(-2)}`;
                            
                            item.date = startDate;
                            item.startTime = startTime;
                            item.endTime = endTime;
                        });
                        console.log(this.requests);
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });
            },
            methods: {
                viewFullRequest(requestId) {
                    // Redirect to page showing all details of the selected request
                    const selectedRequest = this.requests.find(obj => obj.id === requestId);
                    console.log(selectedRequest);
                    localStorage.setItem('requestData', JSON.stringify(selectedRequest));
                    window.location.href = 'view_full_request.html';
                }
            }
        });
    </script>
</body>

</html>